<style>
	.contract-content { width: 750px;}
</style>
<form id="receivables_add_form" class="form" action="{:U('add')}" method="Post">
	<input type="hidden" name="agreement_id" value="{$contract_info['agreement_id']}"/>
	<input type="hidden" name="contract_id" value="{$contract_info['contract_id']}"/>
	<input type="hidden" name="check_num" value="{$contract_info['check_num']}"/>
	<div class="con-left">服务费：</div>
	<div class="con-right">
		<div class="input-group">
			<input type="number" class="form-control receivables_pay_money" rel="1" value="0" name="commission" />
			<span class="input-group-addon">元</span>
		</div>
	</div>

	<div class="con-left">预付款：</div>
	<div class="con-right">
		<div class="input-group">
			<input type="number" class="form-control receivables_pay_money" rel="1" value="0" name="deposit"/>
			<span class="input-group-addon">元</span>
		</div>
	</div>

	<div class="con-left">材料费：</div>
	<div class="con-right">
		<div class="input-group">
			<input type="number" class="form-control receivables_pay_money" rel="0" value="0" name="packing"/>
			<span class="input-group-addon">元</span>
		</div>
	</div>
	<div class="con-left">返费支出：</div>
	<div class="con-right">
		<div class="input-group">
			<input type="number" class="form-control receivables_pay_money" rel="0" value="0" name="channel_money" />
			<span class="input-group-addon">元</span>
		</div>
	</div>

	<div class="con-left">返费收入：</div>
	<div class="con-right">
		<div class="input-group">
			<input type="number" class="form-control receivables_pay_money" rel="1" value="0" name="return_fee" />
			<span class="input-group-addon">元</span>
		</div>
	</div>
	<div class="con-left">其他金额：</div>
	<div class="con-right">
		<div class="input-group">
			<input type="number" class="form-control receivables_pay_money" rel="1" value="0" name="other_fee" />
			<span class="input-group-addon">元</span>
		</div>
	</div>

	<div class="con-left">支付方式：</div>
	<div class="con-right">
		<select class="form-control" name="pay_type" id="pay_type1">
			<option value=""></option>
			<option value="1">银行转账</option>
			<option value="2">现金</option>
			<option value="3">pos机</option>
			<option value="4">微信</option>
			<option value="5">支付宝</option>
			<option value="6">其他</option>
		</select>
	</div>
	<div class="con-left">支付金额：</div>
	<div class="con-right">
		<div class="input-group">
			<input type="text" class="form-control receivables_pya_total" value="0" name="pay_money" readonly />
			<span class="input-group-addon">元</span>
		</div>
	</div>

	<div id="pay_person_div" style="display: none;">
		<div class="con-left">付款人：</div>
		<div class="con-right"><input type="text" class="form-control" name="payee" /></div>
		<div class="con-left">付款账号：</div>
		<div class="con-right"><input type="text" class="form-control" name="payee_account" /></div>
	</div>

	<div class="con-left">支付日期：</div>
	<div class="con-right">
		<input id="datePicker1" name="pay_time" class="form-control Wdate2" type="text" value="">
	</div>
	<div class="con-left">备注：</div>
	<div class="con-right"><input type="text" class="form-control mark" name="mark" /></div>

	<div style="clear: both;"></div>
	<div style="text-align: center;margin-top: 15px;">
		<input type="submit" class="btn btn-success btn-submit" name="submit" value="保存">&nbsp;&nbsp;&nbsp;
		<input type="button" class="btn btn-primary" onclick="javascript:closeDlg();" value="取消">
	</div>
</form>
<script type="text/javascript">
	datePicker('#datePicker1',true);
	$('.receivables_pay_money').keyup(function(){
		var val=$(this).val();
		if(val=='-'){return false;}
		if(isNaN(val)){
			showError("请正确填写值");
			$(this).val(0);
		}else{
			var total=0;
			$(".receivables_pay_money").each(function(){
				var val=$(this).val();
				if(val==""||isNaN(val)){val=0;}
				var type=$(this).attr('rel');
				if(type==1){total=parseFloat(total)+parseFloat(val);}
				else{total=parseFloat(total)-parseFloat(val);}
			});
			$('.receivables_pya_total').val(total);
		}
	});

	$("#pay_type1").bind("change",function(){
		if($(this).val()==1){
			$('#pay_person_div').show();
		}else{
			$('#pay_person_div').hide();
		}
	});

	$('#receivables_add_form').ajaxForm({success:success,beforeSend:checkForm});
	function success(data){
		if(data.errNum==0){
			showSuccess(data.retData);

			$('.tab-pane').removeClass('active');
			$('#tab_receivables_info').addClass('active');
			var link = "{:U('Receivables/table')}?contract_id={$contract_info['contract_id']}";
			loadURL(link,"#tab_receivables_info");
			$('.nav-tabs li').removeClass('active');
			$('.nav-tabs li a').each(function(){
				if($(this).attr('href')=="#tab_receivables_info"){
					$(this).parent().addClass('active');
				}
			});
		}else{
			showError(data.errMsg);
		}
	}
	function checkForm(){
		if($('#pay_type1').val()==''){showError('请选择支付方式'); return false;}
		if($('#datePicker1').val()==""){showError('请填写支付时间'); return false;}
		$(".btn-submit").attr({"disabled":"disabled"});
	}

	$('.receivables_pay_money').focus(function(){
		var val=$(this).val();
		if(val==0){
			$(this).val('');
		}
	});
	$('.receivables_pay_money').blur(function(){
		var val=$(this).val();
		if(val==''){
			$(this).val(0);
		}
	});
</script>