<form id="contract_add_form" class="form" action="{:U('edit')}" method="Post">
	<style>
		.contract-content { width: 600px; max-height: 550px; overflow: auto }
		.contract-content div{ display: block; vertical-align: middle; }
		.contract-content .con-left { width: 18%; float: left; text-align: right; padding-right: 5px; font-weight: 700;height: 40px;}
		.contract-content .con-right { width: 32%; float: left;height: 40px;clear:right}
		.product-num { margin-bottom: 20px;padding-right: 10px; }
	</style>
	<div class="contract-content">
		<input type="hidden" name="agency_id" value="{$agency_info['agency_id']}"/>
		<div class="con-left">分公司：</div>
		<div class="con-right">
			<select class="form-control" name="sub_company_id" >
				<volist name="sub_company_list" id="vo" >
					<option value="{$vo['department_id']}" <if condition="$agency_info['sub_company_id'] eq $vo['department_id']">selected</if> >{$vo['name']}</option>
				</volist>
			</select>
		</div>
		<div class="con-left">机构名称：</div>
		<div class="con-right"><input type="text" class="form-control" name="agency_name" value="{$agency_info['agency_name']}"/></div>

		<div class="con-left">对接人：</div>
		<div class="con-right"><input type="text" class="form-control" name="agency_owner" value="{$agency_info['agency_owner']}"/></div>
		<div class="con-left">联系电话：</div>
		<div class="con-right"><input type="text" class="form-control" name="agency_phone" value="{$agency_info['agency_phone']}"/></div>

		<div class="con-left">维护人：</div>
		<div class="con-right"><input type="text" class="form-control" name="owner" value="{$agency_info['owner']}"/></div>
		<div class="con-left">联系电话：</div>
		<div class="con-right"><input type="text" class="form-control" name="phone" value="{$agency_info['phone']}"/></div>
		<div style="clear: both;"></div>
		<empty name="agency_info['product']">
			<div class="product-num">产品1：<a href="javascript:void(0);" id="add_product_div" class="pull-right btn btn-success" >添加</a></div>
			<div id="product_1">
				<div class="con-left">产品类型：</div>
				<div class="con-right" style="width: 82%;">
					<select class="form-control" style="width: 32%;float: left;" name="type1[]">
						<option value="信贷">信贷</option>
						<option value="抵押">抵押</option>
					</select>
					<select class="form-control" style="width: 32%;float: left;margin-left: 2%;" name="type2[]">
						<option value="消费贷">消费贷</option>
						<option value="经营贷">经营贷</option>
					</select>
					<select class="form-control" style="width: 32%;float: left;margin-left: 2%;" name="type3[]">
						<option value="个人">个人</option>
						<option value="企业">企业</option>
					</select>
				</div>

				<div style="clear: both;"></div>
				<div class="con-left">产品描述：</div>
				<div class="con-right" style="width: 82%;height: auto;margin-bottom: 15px;">
					<textarea rows="2" class="form-control" name="description[]"></textarea>
				</div>
			</div>
			<else/>
			<volist name="agency_info['product']" id="vo" >
				<if condition="$key eq 0">
					<div class="product-num">产品1：<a href="javascript:void(0);" id="add_product_div" class="pull-right btn btn-success" >添加</a></div>
					<div id="product_1">
					<else/>
						<div id="product_{$key+1}">
							<div class="product-num">产品{$key+1}：<a href="javascript:void(0);" class="pull-right btn btn-primary" onclick="delete_product_div({$key+1})" >删除</a></div>
				</if>

					<div class="con-left">产品类型：</div>
					<div class="con-right" style="width: 82%;">
						<select class="form-control" style="width: 32%;float: left;" name="type1[]">
							<option value="信贷" <if condition="$vo['type1'] eq '信贷'">selected</if> >信贷</option>
							<option value="抵押" <if condition="$vo['type1'] eq '信贷'">selected</if> >抵押</option>
						</select>
						<select class="form-control" style="width: 32%;float: left;margin-left: 2%;" name="type2[]">
							<option value="消费贷" <if condition="$vo['type2'] eq '消费贷'">selected</if> >消费贷</option>
							<option value="经营贷" <if condition="$vo['type2'] eq '经营贷'">selected</if> >经营贷</option>
						</select>
						<select class="form-control" style="width: 32%;float: left;margin-left: 2%;" name="type3[]">
							<option value="个人" <if condition="$vo['type3'] eq '个人'">selected</if> >个人</option>
							<option value="企业" <if condition="$vo['type3'] eq '企业'">selected</if> >企业</option>
						</select>
					</div>

					<div style="clear: both;"></div>
					<div class="con-left">产品描述：</div>
					<div class="con-right" style="width: 82%;height: auto;margin-bottom: 15px;">
						<textarea rows="2" class="form-control" name="description[]">{$vo['description']}</textarea>
					</div>
				</div>
			</volist>
		</empty>

		<div style="clear: both;" id="product_div" data-id="{$agency_info['product_num']}"></div>
		<div style="text-align: center;">
			<input type="submit" class="btn btn-success" name="submit" value="保存">&nbsp;&nbsp;&nbsp;
			<input type="button" class="btn btn-primary" onclick="javascript:closeDlg();" value="取消">
		</div>
	</div>
</form>
<script type="text/javascript">
	$('#contract_add_form').ajaxForm({success:success,beforeSend:checkForm});
	function success(data){
		if(data.errNum==0){
			showSuccess(data.errMsg);
			var url = "{:U('index')}";
			pageLoad(url,'#page-wrapper');
			closeDlg();
		}else{
			showError(data.errMsg);
		}
	}
	function checkForm(){
		if('' === $('input[name=agency_name]').val()){
			showError('机构名不能为空！');
			return false;
		}
		return true;
	}
	$('#add_product_div').click(function () {
		var str = $(this).parent().next().html();
		var id = parseInt($('#product_div').attr('data-id'))+1;
		str = '<div id="product_'+id+'"><div class="product-num">产品'+id+'：<a href="javascript:void(0);" class="pull-right btn btn-primary" onclick="delete_product_div('+id+')" >删除</a></div>'+str+'</div>';
		$('#product_div').before(str);
		$('#product_div').attr('data-id',id);
	})
	function delete_product_div(id) {
		$('#product_'+id).remove();
		var id = parseInt($('#product_div').attr('data-id'));
		$('#product_div').attr('data-id',id-1);
	}
</script>