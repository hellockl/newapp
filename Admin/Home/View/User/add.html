<form id="receivables_add_form" class="form" action="{:U('add')}" method="Post">
	<input type="hidden" name="agreement_id" value="{$contract_info['agreement_id']}"/>
	<input type="hidden" name="contract_id" value="{$contract_info['contract_id']}"/>
	<input type="hidden" name="check_num" value="{$contract_info['check_num']}"/>
	<div class="con-left">服务费：</div>
	<div class="con-right"><input type="number" class="form-control receivables_pay_money" value="0" name="commission" /></div>

	<div class="con-left">预付款：</div>
	<div class="con-right"><input type="number" class="form-control receivables_pay_money" value="0" name="deposit"/></div>

	<div class="con-left">材料费：</div>
	<div class="con-right"><input type="number" class="form-control receivables_pay_money" value="0" name="packing"/></div>
	<div class="con-left">返费支出：</div>
	<div class="con-right"><input type="number" class="form-control receivables_pay_money" value="0" name="channel_money" /></div>

	<div class="con-left">返费收入：</div>
	<div class="con-right"><input type="number" class="form-control receivables_pay_money" value="0" name="return_fee" /></div>
	<div class="con-left">其他金额：</div>
	<div class="con-right"><input type="number" class="form-control receivables_pay_money" value="0" name="other_fee" /></div>

	<div class="con-left">支付方式：</div>
	<div class="con-right">
		<select class="form-control" name="pay_type" id="pay_type">
			<option value=""></option>
			<option value="1">银行转账</option>
			<option value="2">现金</option>
			<option value="3">pos机</option>
			<option value="4">微信</option>
			<option value="5">支付宝</option>
			<option value="6">其他</option>
		</select>
	</div>
	<div class="con-left">支付金额：</div>
	<div class="con-right"><input type="text" class="form-control receivables_pya_total" value="0" name="pay_money" readonly /></div>

	<div id="pay_person_div" style="display: none;">
		<div class="con-left">付款人：</div>
		<div class="con-right"><input type="text" class="form-control" name="payee" /></div>
		<div class="con-left">付款账号：</div>
		<div class="con-right"><input type="text" class="form-control" name="payee_account" /></div>
	</div>

	<div class="con-left">支付日期：</div>
	<div class="con-right">
		<input onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" id="datePicker" name="pay_time" class="form-control Wdate2" type="text" value="">
	</div>
	<div class="con-left">备注：</div>
	<div class="con-right"><input type="text" class="form-control mark" name="mark" /></div>

	<div style="clear: both;"></div>
	<div style="text-align: center;margin-top: 15px;">
		<input type="submit" class="btn btn-success" name="submit" value="保存">&nbsp;&nbsp;&nbsp;
		<input type="button" class="btn btn-primary" onclick="javascript:closeDlg();" value="取消">
	</div>
</form>
<script type="text/javascript">
	datePicker('#datePicker',true);
	$('.receivables_pay_money').keyup(function(){
		var val=$(this).val();
		if(val=='-'){return false;}
		if(isNaN(val)){
			showError("请正确填写值");
			$(this).val(0);
		}else{
			var total=0;
			$(".receivables_pay_money").each(function(){
				var val=$(this).val();
				if(val==""||isNaN(val)){val=0;}
				total=parseFloat(total)+parseFloat(val);
			});
			$('.receivables_pya_total').val(total);
		}
	});

	$("#pay_type").bind("change",function(){
		if($(this).val()==1){
			$('#pay_person_div').show();
		}else{
			$('#pay_person_div').hide();
		}
	});

	$('#receivables_add_form').ajaxForm({success:success,beforeSend:checkForm});
	function success(data){
		if(data.errNum==0){
			showSuccess(data.retData);
			$('.receivables_pay_money').val(0);
			$('.receivables_pya_total').val(0);
			$('#datePicker').val('');
			$('.mark').val('');
		}else{
			showError(data.errMsg);
		}
	}
	function checkForm(){

	}

	$('.receivables_pay_money').focus(function(){
		var val=$(this).val();
		if(val==0){
			$(this).val('');
		}
	});
	$('.receivables_pay_money').blur(function(){
		var val=$(this).val();
		if(val==''){
			$(this).val(0);
		}
	});
</script>